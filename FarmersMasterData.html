<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="logo.png" type="image/png">
  <title>Farmer Data Search</title>

  <!-- PapaParse for accurate CSV parsing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    input { padding: 8px; width: 300px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; }
    th { background-color: #ffe600; }
    #loading { margin-top: 10px; font-style: italic; color: gray; }
  </style>
</head>

<body>

  <h2>Paddy Procurement Sheet (Master)</h2>
  <input type="text" id="searchBox" placeholder="Search by any field..." onkeyup="filterData()">
  <div id="loading">Loading data...</div>

  <table id="dataTable" style="display: none;">
    <thead></thead>
    <tbody></tbody>
  </table>

<script>

  const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSS57_epcp9i_8C3_u_tFXQU9mS7b8ApjRFuIzikLlV1nTpKpe_Yf1qKm0TyRkFvQ/pub?output=csv";

  let dataRows = [];
  let headers = [];

  fetch(sheetURL)
    .then(res => res.text())
    .then(csv => {
      const parsed = Papa.parse(csv, { header: true, skipEmptyLines: true });
      headers = parsed.meta.fields;
      dataRows = parsed.data;

      createTableHeader();
      document.getElementById("loading").style.display = "none";
    });

  function createTableHeader() {
    const table = document.getElementById("dataTable");
    const thead = table.querySelector("thead");
    thead.innerHTML = "";

    const tr = document.createElement("tr");
    headers.forEach(col => {
      const th = document.createElement("th");
      th.textContent = col;
      tr.appendChild(th);
    });
    thead.appendChild(tr);
  }

  function renderTable(data) {
    const table = document.getElementById("dataTable");
    const tbody = table.querySelector("tbody");
    tbody.innerHTML = "";

    if (data.length === 0) {
      table.style.display = "none";
      return;
    }

    data.forEach(row => {
      const tr = document.createElement("tr");
      headers.forEach(h => {
        const td = document.createElement("td");
        td.textContent = row[h] || "";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });

    table.style.display = "table";
  }

  function filterData() {
    const keyword = document.getElementById("searchBox").value.toLowerCase();

    if (!keyword) {
      document.getElementById("dataTable").style.display = "none";
      return;
    }

    const filtered = dataRows.filter(row =>
      Object.values(row).some(val => (val || "").toLowerCase().includes(keyword))
    );

    renderTable(filtered);
  }
</script>

</body>
</html>
